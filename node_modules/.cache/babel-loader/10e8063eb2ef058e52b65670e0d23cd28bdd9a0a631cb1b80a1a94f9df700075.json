{"ast":null,"code":"import { Client } from \"@stomp/stompjs\"; // ‚úÖ Ïò¨Î∞îÎ•∏ ÏûÑÌè¨Ìä∏\nimport axios from \"axios\";\n\n// ‚úÖ Ï∂îÍ∞ÄÎêú Ìï®Ïàò: Ïø†ÌÇ§ÏóêÏÑú accessTokenÏùÑ Í∞ÄÏ†∏Ïò§Îäî Ìï®Ïàò\nconst getAccessTokenFromCookie = () => {\n  const cookies = document.cookie.split(\"; \").reduce((acc, cookie) => {\n    const [key, value] = cookie.split(\"=\");\n    acc[key] = value;\n    return acc;\n  }, {});\n  return cookies.accessToken || null; // `accessToken` Ïø†ÌÇ§Í∞Ä ÏóÜÏúºÎ©¥ `null` Î∞òÌôò\n};\nconst connectToChat = async () => {\n  try {\n    // ‚úÖ Ï∂îÍ∞Ä: accessTokenÏùÑ Ïø†ÌÇ§ÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞\n    const accessToken = getAccessTokenFromCookie();\n    if (!accessToken) {\n      console.error(\"‚õî Access Token ÏóÜÏùå, WebSocket Ïó∞Í≤∞ Ï§ëÎã®\");\n      return;\n    }\n    console.log(\"üîç ÌòÑÏû¨ Access Token:\", accessToken); // ‚úÖ Access Token ÌôïÏù∏\n\n    // 1Ô∏è‚É£ Secondary Token ÏöîÏ≤≠ (‚úÖ Ï∂îÍ∞Ä: Authorization Ìó§Îçî Ìè¨Ìï®)\n    const response = await axios.post(\"http://localhost:8082/api/user/secondary-token\", {}, {\n      headers: {\n        Authorization: `Bearer ${accessToken}`\n      },\n      // ‚úÖ Ï∂îÍ∞ÄÎê®: Authorization Ìó§Îçî ÏÑ§Ï†ï\n      withCredentials: true\n    });\n    const secondaryToken = response.data.secondaryToken;\n    console.log(\"‚úÖ Secondary Token:\", secondaryToken);\n\n    // 2Ô∏è‚É£ WebSocket Ïó∞Í≤∞ (Secondary Token Ìè¨Ìï®)\n    const client = new Client({\n      brokerURL: `ws://localhost:8082/ws?secondaryToken=${secondaryToken}`,\n      reconnectDelay: 5000,\n      onConnect: frame => {\n        console.log(\"üü¢ WebSocket Ïó∞Í≤∞ ÏÑ±Í≥µ:\", frame);\n\n        // 3Ô∏è‚É£ ÌäπÏ†ï Ï±ÑÌåÖÎ∞© Íµ¨ÎèÖ (teamId = 1 ÏòàÏãú)\n        client.subscribe(\"/topic/chat/1\", message => {\n          console.log(\"üì© ÏàòÏã†Îêú Î©îÏãúÏßÄ:\", JSON.parse(message.body));\n        });\n\n        // 4Ô∏è‚É£ Î©îÏãúÏßÄ Î≥¥ÎÇ¥Í∏∞ (ÏòàÏ†ú) - ‚úÖ ÏàòÏ†ïÎê®\n        client.publish({\n          destination: \"/app/chat/send\",\n          headers: {},\n          // ‚úÖ `headers` Ï∂îÍ∞Ä (ÌïÑÏàò)\n          body: JSON.stringify({\n            content: \"Hello Team!\",\n            teamId: 1\n          })\n        });\n      },\n      onStompError: frame => {\n        console.error(\"‚õî WebSocket Ïó∞Í≤∞ Ïã§Ìå®:\", frame);\n      }\n    });\n    client.activate(); // ‚úÖ WebSocket ÌôúÏÑ±Ìôî\n  } catch (error) {\n    console.error(\"‚ùå Secondary Token ÏöîÏ≤≠ Ïã§Ìå®:\", error);\n  }\n};\nexport default connectToChat;","map":{"version":3,"names":["Client","axios","getAccessTokenFromCookie","cookies","document","cookie","split","reduce","acc","key","value","accessToken","connectToChat","console","error","log","response","post","headers","Authorization","withCredentials","secondaryToken","data","client","brokerURL","reconnectDelay","onConnect","frame","subscribe","message","JSON","parse","body","publish","destination","stringify","content","teamId","onStompError","activate"],"sources":["C:/project2/teamverse-2/src/utils/ConnectToChat.js"],"sourcesContent":["import { Client } from \"@stomp/stompjs\"; // ‚úÖ Ïò¨Î∞îÎ•∏ ÏûÑÌè¨Ìä∏\r\nimport axios from \"axios\";\r\n\r\n// ‚úÖ Ï∂îÍ∞ÄÎêú Ìï®Ïàò: Ïø†ÌÇ§ÏóêÏÑú accessTokenÏùÑ Í∞ÄÏ†∏Ïò§Îäî Ìï®Ïàò\r\nconst getAccessTokenFromCookie = () => {\r\n  const cookies = document.cookie.split(\"; \").reduce((acc, cookie) => {\r\n    const [key, value] = cookie.split(\"=\");\r\n    acc[key] = value;\r\n    return acc;\r\n  }, {});\r\n\r\n  return cookies.accessToken || null; // `accessToken` Ïø†ÌÇ§Í∞Ä ÏóÜÏúºÎ©¥ `null` Î∞òÌôò\r\n};\r\n\r\nconst connectToChat = async () => {\r\n  try {\r\n    // ‚úÖ Ï∂îÍ∞Ä: accessTokenÏùÑ Ïø†ÌÇ§ÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞\r\n    const accessToken = getAccessTokenFromCookie();\r\n    if (!accessToken) {\r\n      console.error(\"‚õî Access Token ÏóÜÏùå, WebSocket Ïó∞Í≤∞ Ï§ëÎã®\");\r\n      return;\r\n    }\r\n\r\n    console.log(\"üîç ÌòÑÏû¨ Access Token:\", accessToken); // ‚úÖ Access Token ÌôïÏù∏\r\n\r\n    // 1Ô∏è‚É£ Secondary Token ÏöîÏ≤≠ (‚úÖ Ï∂îÍ∞Ä: Authorization Ìó§Îçî Ìè¨Ìï®)\r\n    const response = await axios.post(\r\n      \"http://localhost:8082/api/user/secondary-token\",\r\n      {},\r\n      {\r\n        headers: { Authorization: `Bearer ${accessToken}` }, // ‚úÖ Ï∂îÍ∞ÄÎê®: Authorization Ìó§Îçî ÏÑ§Ï†ï\r\n        withCredentials: true,\r\n      }\r\n    );\r\n\r\n    const secondaryToken = response.data.secondaryToken;\r\n    console.log(\"‚úÖ Secondary Token:\", secondaryToken);\r\n\r\n    // 2Ô∏è‚É£ WebSocket Ïó∞Í≤∞ (Secondary Token Ìè¨Ìï®)\r\n    const client = new Client({\r\n      brokerURL: `ws://localhost:8082/ws?secondaryToken=${secondaryToken}`,\r\n      reconnectDelay: 5000,\r\n      onConnect: (frame) => {\r\n        console.log(\"üü¢ WebSocket Ïó∞Í≤∞ ÏÑ±Í≥µ:\", frame);\r\n\r\n        // 3Ô∏è‚É£ ÌäπÏ†ï Ï±ÑÌåÖÎ∞© Íµ¨ÎèÖ (teamId = 1 ÏòàÏãú)\r\n        client.subscribe(\"/topic/chat/1\", (message) => {\r\n          console.log(\"üì© ÏàòÏã†Îêú Î©îÏãúÏßÄ:\", JSON.parse(message.body));\r\n        });\r\n\r\n        // 4Ô∏è‚É£ Î©îÏãúÏßÄ Î≥¥ÎÇ¥Í∏∞ (ÏòàÏ†ú) - ‚úÖ ÏàòÏ†ïÎê®\r\n        client.publish({\r\n          destination: \"/app/chat/send\",\r\n          headers: {}, // ‚úÖ `headers` Ï∂îÍ∞Ä (ÌïÑÏàò)\r\n          body: JSON.stringify({\r\n            content: \"Hello Team!\",\r\n            teamId: 1,\r\n          }),\r\n        });\r\n      },\r\n      onStompError: (frame) => {\r\n        console.error(\"‚õî WebSocket Ïó∞Í≤∞ Ïã§Ìå®:\", frame);\r\n      },\r\n    });\r\n\r\n    client.activate(); // ‚úÖ WebSocket ÌôúÏÑ±Ìôî\r\n  } catch (error) {\r\n    console.error(\"‚ùå Secondary Token ÏöîÏ≤≠ Ïã§Ìå®:\", error);\r\n  }\r\n};\r\n\r\nexport default connectToChat;\r\n"],"mappings":"AAAA,SAASA,MAAM,QAAQ,gBAAgB,CAAC,CAAC;AACzC,OAAOC,KAAK,MAAM,OAAO;;AAEzB;AACA,MAAMC,wBAAwB,GAAGA,CAAA,KAAM;EACrC,MAAMC,OAAO,GAAGC,QAAQ,CAACC,MAAM,CAACC,KAAK,CAAC,IAAI,CAAC,CAACC,MAAM,CAAC,CAACC,GAAG,EAAEH,MAAM,KAAK;IAClE,MAAM,CAACI,GAAG,EAAEC,KAAK,CAAC,GAAGL,MAAM,CAACC,KAAK,CAAC,GAAG,CAAC;IACtCE,GAAG,CAACC,GAAG,CAAC,GAAGC,KAAK;IAChB,OAAOF,GAAG;EACZ,CAAC,EAAE,CAAC,CAAC,CAAC;EAEN,OAAOL,OAAO,CAACQ,WAAW,IAAI,IAAI,CAAC,CAAC;AACtC,CAAC;AAED,MAAMC,aAAa,GAAG,MAAAA,CAAA,KAAY;EAChC,IAAI;IACF;IACA,MAAMD,WAAW,GAAGT,wBAAwB,CAAC,CAAC;IAC9C,IAAI,CAACS,WAAW,EAAE;MAChBE,OAAO,CAACC,KAAK,CAAC,oCAAoC,CAAC;MACnD;IACF;IAEAD,OAAO,CAACE,GAAG,CAAC,qBAAqB,EAAEJ,WAAW,CAAC,CAAC,CAAC;;IAEjD;IACA,MAAMK,QAAQ,GAAG,MAAMf,KAAK,CAACgB,IAAI,CAC/B,gDAAgD,EAChD,CAAC,CAAC,EACF;MACEC,OAAO,EAAE;QAAEC,aAAa,EAAE,UAAUR,WAAW;MAAG,CAAC;MAAE;MACrDS,eAAe,EAAE;IACnB,CACF,CAAC;IAED,MAAMC,cAAc,GAAGL,QAAQ,CAACM,IAAI,CAACD,cAAc;IACnDR,OAAO,CAACE,GAAG,CAAC,oBAAoB,EAAEM,cAAc,CAAC;;IAEjD;IACA,MAAME,MAAM,GAAG,IAAIvB,MAAM,CAAC;MACxBwB,SAAS,EAAE,yCAAyCH,cAAc,EAAE;MACpEI,cAAc,EAAE,IAAI;MACpBC,SAAS,EAAGC,KAAK,IAAK;QACpBd,OAAO,CAACE,GAAG,CAAC,qBAAqB,EAAEY,KAAK,CAAC;;QAEzC;QACAJ,MAAM,CAACK,SAAS,CAAC,eAAe,EAAGC,OAAO,IAAK;UAC7ChB,OAAO,CAACE,GAAG,CAAC,aAAa,EAAEe,IAAI,CAACC,KAAK,CAACF,OAAO,CAACG,IAAI,CAAC,CAAC;QACtD,CAAC,CAAC;;QAEF;QACAT,MAAM,CAACU,OAAO,CAAC;UACbC,WAAW,EAAE,gBAAgB;UAC7BhB,OAAO,EAAE,CAAC,CAAC;UAAE;UACbc,IAAI,EAAEF,IAAI,CAACK,SAAS,CAAC;YACnBC,OAAO,EAAE,aAAa;YACtBC,MAAM,EAAE;UACV,CAAC;QACH,CAAC,CAAC;MACJ,CAAC;MACDC,YAAY,EAAGX,KAAK,IAAK;QACvBd,OAAO,CAACC,KAAK,CAAC,oBAAoB,EAAEa,KAAK,CAAC;MAC5C;IACF,CAAC,CAAC;IAEFJ,MAAM,CAACgB,QAAQ,CAAC,CAAC,CAAC,CAAC;EACrB,CAAC,CAAC,OAAOzB,KAAK,EAAE;IACdD,OAAO,CAACC,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;EAClD;AACF,CAAC;AAED,eAAeF,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}